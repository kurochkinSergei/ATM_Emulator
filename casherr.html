<!doctype html>
<html>
<script type="text/javascript" src="../js/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="../js/idle-timer.min.js"></script>
<link rel="stylesheet" type="text/css" href="jquery.keypad.css" />

<head>
</head>
<style>
    body {
        background-image: url(backlang3.png);
    }
</style>

<body>
    <h1 id='name' style="font-size:60px;text-align:center;position:fixed;top:20%;width:900px"></h1>
    <h1 id='casherr' style="font-size:60px;text-align:center;position:fixed;top:30%;width:800px">Выдача наличных в данный момент невозможна. Приносим извинения за временные неудобства.</h1>

    <script>
        function req() {
            $.ajax({
                    url: 'http://10.20.1.21:5000/atm_status',
                })
                .done(function(data) {
                    console.log("Ajax was succsessfully sent");
                    console.log(data.status);
                    if (data.status == false) {
                        location = "outofserv.html"
                    }
                })
                .fail(function() {
                    console.log("Ajax failed to fetch data")
                })
        }
        setInterval(req, 3000);

        function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        };
        transliterate = (
            function() {
                var
                    rus = "ю ч ш щ х я ё ж а б д е ф г и дж к л м н о п р с т у в з ь".split(/ +/g),
                    eng = "yu ch sh sch kh ya yo zh a b d e f g i j k l m n o p r s t u v z '".split(/ +/g);
                return function(text, engToRus) {
                    var x;
                    for (x = 0; x < rus.length; x++) {
                        text = text.split(engToRus ? eng[x] : rus[x]).join(engToRus ? rus[x] : eng[x]);
                        text = text.split(engToRus ? eng[x].toUpperCase() : rus[x].toUpperCase()).join(engToRus ? rus[x].toUpperCase() : eng[x].toUpperCase());
                    }
                    return text;
                }
            }
        )();
        var text = readCookie("Text");
        var textrus = transliterate(transliterate(text), true);
        $.idleTimer(7000);
        $(document).bind('idle.idleTimer', function() {
            location.href = 'main.html'
        });
        $('#name').text('Здравствуйте, ' + textrus + '!');
        document.getElementById('casherr').style.left = $(window).width() / 2 - 400 + 'px';
        document.getElementById('name').style.left = $(window).width() / 2 - 450 + 'px';
    </script>
</body>

</html>